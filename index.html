<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>üî• Fire Drake Merge üî•</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom, #660000, #990000, #330000); /* bloody red */
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1 {
      font-size: 36px;
      color: #ff4444;
      text-shadow: 0 0 10px #ff0000;
      margin: 10px 0;
    }
    #stats {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 10px 0;
      font-size: 18px;
      font-weight: bold;
    }
    #coins { color: gold; text-shadow: 0 0 6px gold; }
    #ingots { color: goldenrod; text-shadow: 0 0 6px goldenrod; }
    #income { color: lime; text-shadow: 0 0 6px lime; }
    #multiplier { color: violet; text-shadow: 0 0 6px violet; }
    #nextCost { color: white; }

    #game {
      margin: 15px auto;
      display: grid;
      gap: 6px;
      justify-content: center;
      background: rgba(0,0,0,0.25);
      padding: 10px;
      border-radius: 12px;
    }
    .cell {
      width: 80px;
      height: 80px;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      cursor: pointer;
      transition: transform .12s, box-shadow .12s;
    }
    .cell:hover { transform: translateY(-2px); box-shadow: 0 0 10px rgba(255,0,0,0.4); }
    .selected { outline: 3px solid yellow; outline-offset: -4px; }

    .drake img { width: 60px; height: 60px; }
    .drake span { font-size: 12px; font-weight: bold; margin-top: 2px; }

    #controls {
      margin: 20px auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: center;
    }
    .btn {
      width: 240px;
      padding: 10px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      color: #000;
      transition: transform .12s, box-shadow .12s;
    }
    .btn:active { transform: translateY(2px); }
    #buyDrake { background: linear-gradient(#ffdd66,#ff9933); }
    #buyIngot { background: linear-gradient(#ffee88,#ffcc00); }
    #expandGrid { background: linear-gradient(#88ff88,#33cc33); }
    #saveGame { background: linear-gradient(#88ddff,#3399ff); }
    #prestige { background: linear-gradient(#ddaaff,#9955ff); }
    #deleteProgress { background: linear-gradient(#ff7777,#cc2222); color:#fff; }
  </style>
</head>
<body>
  <h1>üî• Fire Drake Merge üî•</h1>

  <div id="stats">
    <div>Coins: <span id="coins">20</span></div>
    <div>Ingots: <span id="ingots">0</span></div>
    <div>Income: <span id="income">0 /sec</span></div>
    <div>Multiplier: <span id="multiplier">1x</span></div>
    <div>Next Drake: <span id="nextCost">20</span></div>
  </div>

  <div id="game"></div>

  <div id="controls">
    <button id="buyDrake" class="btn">Buy Drake (20)</button>
    <button id="buyIngot" class="btn">Buy Ingot (1K)</button>
    <button id="expandGrid" class="btn">Expand Grid</button>
    <button id="saveGame" class="btn">Save Progress</button>
    <button id="prestige" class="btn">Prestige (1M)</button>
    <button id="deleteProgress" class="btn">‚ùå Delete Progress</button>
  </div>

<script>
let coins = 20;
let ingots = 0;
let gridSize = 3;
let drakeCost = 20;
let multiplier = 1;
let selectedDrake = null;

/* drake data: income/sec and image */
const drakeData = {
  1:{income:1, img:"/lvl1drake.png"},
  2:{income:3, img:"/lvl2drake.png"},
  3:{income:10, img:"/lvl3drake.png"},
  4:{income:25, img:"/lvl4drake.png"},
  5:{income:60, img:"/lvl5drake.png"},
  6:{income:150,img:"/lvl6drake.png"},
  7:{income:400,img:"/lvl7drake.png"},
  8:{income:1000,img:"/lvl8drake.png"}
};

const coinsEl=document.getElementById("coins");
const ingotsEl=document.getElementById("ingots");
const incomeEl=document.getElementById("income");
const multEl=document.getElementById("multiplier");
const nextCostEl=document.getElementById("nextCost");
const game=document.getElementById("game");

function formatNumber(n){
  if(n>=1e6) return (n/1e6).toFixed(2)+"M";
  if(n>=1e3) return (n/1e3).toFixed(2)+"K";
  return Math.floor(n);
}

function createGrid(size){
  game.innerHTML="";
  game.style.gridTemplateColumns=`repeat(${size},1fr)`;
  for(let i=0;i<size*size;i++){
    const cell=document.createElement("div");
    cell.className="cell";
    game.appendChild(cell);
  }
}

function spawnDrake(cell,level){
  const d=document.createElement("div");
  d.className="drake";
  d.dataset.level=level;
  d.innerHTML=`<img src="${drakeData[level].img}"><span class="lvl${level}">lvl${level}</span>`;
  d.onclick=()=>selectDrake(d);
  cell.appendChild(d);
  updateIncome();
}

function selectDrake(drake){
  if(!selectedDrake){
    selectedDrake=drake;
    drake.parentElement.classList.add("selected");
  } else if(selectedDrake===drake){
    selectedDrake.parentElement.classList.remove("selected");
    selectedDrake=null;
  } else {
    let l1=parseInt(selectedDrake.dataset.level);
    let l2=parseInt(drake.dataset.level);
    if(l1===l2 && l1<8){
      drake.remove();
      selectedDrake.parentElement.classList.remove("selected");
      selectedDrake.remove();
      spawnDrake(drake.parentElement,l1+1);
    }
    selectedDrake=null;
  }
}

function updateStats(){
  coinsEl.textContent=formatNumber(coins);
  ingotsEl.textContent=formatNumber(ingots);
  multEl.textContent=multiplier+"x";
  nextCostEl.textContent=formatNumber(drakeCost);
}

function updateIncome(){
  let total=0;
  document.querySelectorAll(".drake").forEach(d=>{
    total+=drakeData[parseInt(d.dataset.level)].income;
  });
  incomeEl.textContent=`${formatNumber(total*multiplier)} /sec`;
}

function buyDrake(){
  const emptyCell=[...document.querySelectorAll(".cell")].find(c=>c.children.length===0);
  if(!emptyCell){alert("No space left!");return;}
  if(coins>=drakeCost){
    coins-=drakeCost;
    spawnDrake(emptyCell,1);
    drakeCost=Math.floor(drakeCost*1.25);
    updateStats();
  } else alert("Not enough coins");
}

function buyIngot(){
  if(coins>=1000){ coins-=1000; ingots++; updateStats();}
  else alert("Not enough coins");
}

function expandGrid(){
  let next=gridSize+1;
  let cost=0,ingCost=0;
  if(next===4){cost=1000;ingCost=1;}
  else if(next===5){cost=10000;ingCost=2;}
  else if(next===6){cost=100000;ingCost=5;}
  else {alert("Max grid reached");return;}
  if(coins>=cost && ingots>=ingCost){
    coins-=cost; ingots-=ingCost;
    gridSize=next;
    createGrid(gridSize);
    updateStats();
  } else alert("Not enough resources");
}

function saveGame(){
  const data={coins,ingots,gridSize,drakeCost,multiplier,drakes:[]};
  document.querySelectorAll(".cell").forEach((cell,i)=>{
    if(cell.firstChild){
      data.drakes.push({i,level:parseInt(cell.firstChild.dataset.level)});
    }
  });
  localStorage.setItem("fireDrakeSave",JSON.stringify(data));
  alert("Progress saved!");
}

function loadGame(){
  let s=localStorage.getItem("fireDrakeSave");
  if(!s){createGrid(gridSize);return;}
  const data=JSON.parse(s);
  coins=data.coins??20;
  ingots=data.ingots??0;
  gridSize=data.gridSize??3;
  drakeCost=data.drakeCost??20;
  multiplier=data.multiplier??1;
  createGrid(gridSize);
  data.drakes.forEach(d=>{
    spawnDrake(game.children[d.i],d.level);
  });
  updateStats();
  updateIncome();
}

function prestige(){
  if(coins>=1e6){
    coins=20; ingots=0; gridSize=3; drakeCost=20;
    multiplier*=2;
    createGrid(gridSize);
    updateStats();
    updateIncome();
    alert("Prestiged! Multiplier is now "+multiplier+"x");
  } else alert("Need 1M coins to prestige!");
}

function deleteProgress(){
  if(confirm("Delete all progress?")){
    localStorage.removeItem("fireDrakeSave");
    coins=20; ingots=0; gridSize=3; drakeCost=20; multiplier=1;
    createGrid(gridSize);
    updateStats(); updateIncome();
  }
}

/* Passive income tick */
setInterval(()=>{
  let total=0;
  document.querySelectorAll(".drake").forEach(d=>{
    total+=drakeData[parseInt(d.dataset.level)].income;
  });
  coins+=total*multiplier;
  updateStats();
},1000);

/* Buttons */
buyDrakeBtn.onclick=buyDrake;
buyIngotBtn.onclick=buyIngot;
expandGridBtn.onclick=expandGrid;
saveBtn.onclick=saveGame;
prestigeBtn.onclick=prestige;
deleteBtn.onclick=deleteProgress;

/* Initialize */
loadGame();
</script>
</body>
</html>
