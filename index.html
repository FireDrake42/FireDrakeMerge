<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>ðŸ”¥ Fire Drake Merge ðŸ”¥</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom, #4a0000, #990000);
      color: white;
      text-align: center;
    }
    #stats {
      font-size: 20px;
      font-weight: bold;
      padding: 10px;
      text-shadow: 0 0 5px black;
    }
    #coins { color: gold; }
    #ingots { color: #ffcc66; }
    #income { color: lime; }
    #mult { color: cyan; }
    #grid {
      display: grid;
      justify-content: center;
      gap: 5px;
      margin: 20px auto;
    }
    .cell {
      width: 90px;
      height: 90px;
      background: rgba(255,255,255,0.1);
      border: 2px solid #fff;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .drake-img { width: 60px; height: 60px; }
    .lvl-label {
      font-size: 14px;
      font-weight: bold;
      color: yellow;
    }
    #buttons {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    button {
      padding: 10px 15px;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 0 5px black;
      transition: all 0.2s;
    }
    button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px white;
    }
    #saveBtn { background: limegreen; color: black; }
    #deleteBtn { background: crimson; color: white; }
    #prestigeBtn { background: cyan; color: black; }
  </style>
</head>
<body>
  <div id="stats">
    Coins: <span id="coins">20</span> |
    Ingots: <span id="ingots">0</span> |
    Passive Income: <span id="income">0</span>/sec |
    Multiplier: <span id="mult">1x</span>
  </div>

  <div id="buttons">
    <button id="buyDrakeBtn">Buy Drake (20)</button>
    <button id="buyIngotBtn">Buy Ingot (1.00K)</button>
    <button id="expandBtn">Expand Grid (1.00K coins + 1 ingot)</button>
    <button id="saveBtn">Save Progress</button>
    <button id="prestigeBtn">Prestige (10.00M coins)</button>
    <button id="autoBuyBtn">Buy Auto Buy (1.00M coins)</button>
    <button id="autoMergeBtn">Buy Auto Merge (1.00M coins)</button>
    <button id="deleteBtn">Delete Progress</button>
  </div>

  <div id="grid"></div>

  <script>
    let coins = 20;
    let ingots = 0;
    let drakeCost = 20;
    let gridSize = 3;
    let multiplier = 1;

    let autoBuyUnlocked = false;
    let autoMergeUnlocked = false;

    let selectedDrake = null;

    const gridEl = document.getElementById("grid");
    const coinsEl = document.getElementById("coins");
    const ingotsEl = document.getElementById("ingots");
    const incomeEl = document.getElementById("income");
    const multEl = document.getElementById("mult");
    const buyDrakeBtn = document.getElementById("buyDrakeBtn");
    const expandBtn = document.getElementById("expandBtn");
    const prestigeBtn = document.getElementById("prestigeBtn");
    const autoBuyBtn = document.getElementById("autoBuyBtn");
    const autoMergeBtn = document.getElementById("autoMergeBtn");

    const drakeStats = {
      1: { income: 1, img: "lvl1drake.png" },
      2: { income: 3, img: "lvl2drake.png" },
      3: { income: 10, img: "lvl3drake.png" },
      4: { income: 25, img: "lvl4drake.png" },
      5: { income: 60, img: "lvl5drake.png" },
      6: { income: 150, img: "lvl6drake.png" },
      7: { income: 400, img: "lvl7drake.png" },
      8: { income: 1000, img: "lvl8drake.png" }
    };

    function formatNumber(n) {
      const suffixes = ["", "K", "M", "B", "T", "Qa", "Qi", "Sx", "Sp", "Oc", "No", "Dc"];
      let tier = Math.floor(Math.log10(n) / 3);
      if (tier <= 0) return Math.floor(n);
      if (tier >= suffixes.length) tier = suffixes.length - 1;
      return (n / Math.pow(10, tier * 3)).toFixed(2) + suffixes[tier];
    }

    function createGrid(size) {
      gridEl.style.gridTemplateColumns = `repeat(${size}, 90px)`;
      gridEl.style.gridTemplateRows = `repeat(${size}, 90px)`;
      gridEl.innerHTML = "";
      for (let i = 0; i < size * size; i++) {
        const cell = document.createElement("div");
        cell.className = "cell";
        gridEl.appendChild(cell);
      }
    }

    function getEmptyCell() {
      return Array.from(document.querySelectorAll(".cell")).find(c => !c.querySelector(".drake"));
    }

    function spawnDrakeInCell(cell, level) {
      const div = document.createElement("div");
      div.className = "drake";
      div.dataset.level = level;
      div.innerHTML = `<img src="${drakeStats[level].img}" class="drake-img"><div class="lvl-label">Lvl ${level}</div>`;
      div.onclick = () => selectDrake(div);
      cell.appendChild(div);
    }

    function selectDrake(drake) {
      if (!selectedDrake) {
        selectedDrake = drake;
        drake.style.outline = "3px solid yellow";
      } else if (selectedDrake === drake) {
        selectedDrake.style.outline = "";
        selectedDrake = null;
      } else {
        if (parseInt(selectedDrake.dataset.level) === parseInt(drake.dataset.level)) {
          const newLevel = parseInt(drake.dataset.level) + 1;
          selectedDrake.parentElement.innerHTML = "";
          drake.parentElement.innerHTML = "";
          spawnDrakeInCell(drake.parentElement, newLevel);
        }
        selectedDrake.style.outline = "";
        selectedDrake = null;
      }
    }

    function updateUI() {
      coinsEl.textContent = formatNumber(coins);
      ingotsEl.textContent = formatNumber(ingots);
      incomeEl.textContent = formatNumber(getTotalIncome()) + "/sec";
      multEl.textContent = formatNumber(multiplier) + "x";
      buyDrakeBtn.textContent = "Buy Drake (" + formatNumber(drakeCost) + ")";
    }

    function getTotalIncome() {
      let total = 0;
      document.querySelectorAll(".drake").forEach(d => {
        total += drakeStats[parseInt(d.dataset.level)].income;
      });
      return total * multiplier;
    }

    function gameLoop() {
      coins += getTotalIncome();
      if (autoBuyUnlocked && coins >= drakeCost && getEmptyCell()) buyDrake();
      if (autoMergeUnlocked) autoMergeDrakes();
      updateUI();
    }

    function buyDrake() {
      const cell = getEmptyCell();
      if (!cell || coins < drakeCost) return;
      coins -= drakeCost;
      spawnDrakeInCell(cell, 1);
      drakeCost = Math.floor(drakeCost * 1.15); // 15% increase
      updateUI();
    }

    function expandGrid() {
      if (gridSize < 6 && coins >= 1000 * gridSize && ingots >= 1) {
        coins -= 1000 * gridSize;
        ingots -= 1;
        gridSize++;
        createGrid(gridSize);
        updateUI();
      }
    }

    function prestige() {
      if (coins < 1e7) return; // 10M
      multiplier *= 2;
      coins = 20;
      ingots = 0;
      gridSize = 3;
      drakeCost = 20;
      autoBuyUnlocked = false;
      autoMergeUnlocked = false;
      createGrid(gridSize);
      updateUI();
    }

    function autoMergeDrakes() {
      for (let lvl = 1; lvl <= 7; lvl++) {
        let sameLevel = Array.from(document.querySelectorAll(".drake"))
          .filter(d => parseInt(d.dataset.level) === lvl);
        while (sameLevel.length >= 2) {
          const d1 = sameLevel.pop().parentElement;
          const d2 = sameLevel.pop().parentElement;
          d1.innerHTML = "";
          d2.innerHTML = "";
          spawnDrakeInCell(d1, lvl + 1);
          sameLevel = Array.from(document.querySelectorAll(".drake"))
            .filter(d => parseInt(d.dataset.level) === lvl);
        }
      }
    }

    // Button Events
    buyDrakeBtn.onclick = buyDrake;
    expandBtn.onclick = expandGrid;
    prestigeBtn.onclick = prestige;
    autoBuyBtn.onclick = () => {
      if (!autoBuyUnlocked && coins >= 1e6) {
        coins -= 1e6;
        autoBuyUnlocked = true;
        autoBuyBtn.textContent = "Auto Buy: UNLOCKED";
      }
    };
    autoMergeBtn.onclick = () => {
      if (!autoMergeUnlocked && coins >= 1e6) {
        coins -= 1e6;
        autoMergeUnlocked = true;
        autoMergeBtn.textContent = "Auto Merge: UNLOCKED";
      }
    };
    document.getElementById("buyIngotBtn").onclick = () => {
      if (coins >= 1000) { coins -= 1000; ingots++; updateUI(); }
    };
    document.getElementById("saveBtn").onclick = () => {
      const state = {
        coins, ingots, gridSize, drakeCost, multiplier,
        autoBuyUnlocked, autoMergeUnlocked,
        drakes: Array.from(document.querySelectorAll(".cell")).map(c =>
          c.querySelector(".drake") ? parseInt(c.querySelector(".drake").dataset.level) : 0
        )
      };
      localStorage.setItem("drakeSave", JSON.stringify(state));
      alert("Progress Saved!");
    };
    document.getElementById("deleteBtn").onclick = () => {
      localStorage.removeItem("drakeSave");
      location.reload();
    };

    function loadGame() {
      const saved = localStorage.getItem("drakeSave");
      if (!saved) return;
      const state = JSON.parse(saved);
      coins = state.coins;
      ingots = state.ingots;
      gridSize = state.gridSize;
      drakeCost = state.drakeCost;
      multiplier = state.multiplier;
      autoBuyUnlocked = state.autoBuyUnlocked;
      autoMergeUnlocked = state.autoMergeUnlocked;
      createGrid(gridSize);
      state.drakes.forEach((lvl, i) => {
        if (lvl > 0) spawnDrakeInCell(document.querySelectorAll(".cell")[i], lvl);
      });
      if (autoBuyUnlocked) autoBuyBtn.textContent = "Auto Buy: UNLOCKED";
      if (autoMergeUnlocked) autoMergeBtn.textContent = "Auto Merge: UNLOCKED";
      updateUI();
    }

    createGrid(gridSize);
    loadGame();
    setInterval(gameLoop, 1000);
  </script>
</body>
</html>
