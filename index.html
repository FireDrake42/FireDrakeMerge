<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>ðŸ”¥ Fire Drake Merge ðŸ”¥</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom, #4a0000, #990000);
      color: white;
      text-align: center;
    }
    #stats {
      font-size: 20px;
      font-weight: bold;
      padding: 10px;
      text-shadow: 0 0 5px black;
    }
    #coins { color: gold; }
    #ingots { color: #ffcc66; }
    #income { color: lime; }
    #mult { color: cyan; }
    #grid {
      display: grid;
      grid-template-columns: repeat(3, 90px);
      grid-template-rows: repeat(3, 90px);
      justify-content: center;
      gap: 5px;
      margin: 20px auto;
    }
    .cell {
      width: 90px;
      height: 90px;
      background: rgba(255,255,255,0.1);
      border: 2px solid #fff;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .drake-img { width: 60px; height: 60px; }
    .lvl-label {
      font-size: 14px;
      font-weight: bold;
      color: yellow;
    }
    #buttons {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin: 20px 0;
    }
    button {
      padding: 10px 15px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background: #ff3333;
      color: white;
      cursor: pointer;
      box-shadow: 0 0 5px black;
    }
    button:hover { background: #ff5555; }
  </style>
</head>
<body>
  <div id="stats">
    Coins: <span id="coins">20</span> | 
    Ingots: <span id="ingots">0</span> | 
    Passive Income: <span id="income">0</span>/sec | 
    Multiplier: <span id="mult">1x</span>
  </div>

  <div id="grid"></div>

  <div id="buttons">
    <button id="buyDrake">Buy Drake (20)</button>
    <button id="buyIngot">Buy Ingot (1,000)</button>
    <button id="expandGrid">Expand Grid</button>
    <button id="autoBuyBtn">Buy Auto Buy (1M)</button>
    <button id="autoMergeBtn">Buy Auto Merge (1M)</button>
    <button id="saveBtn">Save Progress</button>
    <button id="deleteBtn">Delete Progress</button>
    <button id="prestigeBtn">Prestige (10M)</button>
  </div>

  <script>
    // ==== Game State ====
    let coins = 20;
    let ingots = 0;
    let multiplier = 1;
    let drakeCost = 20;
    let gridSize = 3;
    let autoBuyUnlocked = false;
    let autoMergeUnlocked = false;
    let selectedCell = null;

    const gridEl = document.getElementById("grid");
    const coinsEl = document.getElementById("coins");
    const ingotsEl = document.getElementById("ingots");
    const incomeEl = document.getElementById("income");
    const multEl = document.getElementById("mult");
    const buyBtn = document.getElementById("buyDrake");
    const buyIngotBtn = document.getElementById("buyIngot");
    const expandBtn = document.getElementById("expandGrid");
    const autoBuyBtn = document.getElementById("autoBuyBtn");
    const autoMergeBtn = document.getElementById("autoMergeBtn");
    const saveBtn = document.getElementById("saveBtn");
    const deleteBtn = document.getElementById("deleteBtn");
    const prestigeBtn = document.getElementById("prestigeBtn");

    // ==== Helpers ====
    function formatNumber(n){
      if (n >= 1e12) return (n/1e12).toFixed(2)+"T";
      if (n >= 1e9) return (n/1e9).toFixed(2)+"B";
      if (n >= 1e6) return (n/1e6).toFixed(2)+"M";
      if (n >= 1e3) return (n/1e3).toFixed(2)+"K";
      return Math.floor(n);
    }

    function createGrid(size){
      gridEl.style.gridTemplateColumns = `repeat(${size}, 90px)`;
      gridEl.style.gridTemplateRows = `repeat(${size}, 90px)`;
      gridEl.innerHTML="";
      for(let i=0;i<size*size;i++){
        const cell=document.createElement("div");
        cell.className="cell";
        gridEl.appendChild(cell);
      }
    }

    function getEmptyCell(){
      return Array.from(document.querySelectorAll(".cell"))
        .find(c => !c.firstChild);
    }

    function spawnDrakeInCell(cell, level=1){
      const wrap=document.createElement("div");
      wrap.className="drake";
      wrap.dataset.level=level;

      const img=document.createElement("img");
      img.src=`lvl${level}drake.png`;
      img.className="drake-img";

      const lbl=document.createElement("div");
      lbl.className="lvl-label";
      lbl.textContent="Lvl "+level;

      wrap.appendChild(img);
      wrap.appendChild(lbl);

      wrap.onclick=()=>selectDrake(cell, wrap);
      cell.appendChild(wrap);
    }

    function selectDrake(cell, drake){
      if(!selectedCell){
        selectedCell=cell;
        cell.style.border="3px solid yellow";
      } else if(selectedCell===cell){
        cell.style.border="2px solid #fff";
        selectedCell=null;
      } else {
        const other=selectedCell.querySelector(".drake");
        if(other && other.dataset.level===drake.dataset.level){
          const newLvl=parseInt(drake.dataset.level)+1;
          selectedCell.innerHTML="";
          cell.innerHTML="";
          spawnDrakeInCell(cell,newLvl);
        }
        selectedCell.style.border="2px solid #fff";
        selectedCell=null;
      }
    }

    function buyDrake(){
      if(coins>=drakeCost){
        const cell=getEmptyCell();
        if(!cell) return alert("No space!");
        coins-=drakeCost;
        spawnDrakeInCell(cell,1);
        drakeCost = Math.floor(drakeCost*1.15); // 15% scaling
        updateUI();
      }
    }

    function buyIngot(){
      if(coins>=1000){
        coins-=1000;
        ingots++;
        updateUI();
      }
    }

    function expandGrid(){
      if(gridSize<6 && ingots>=1){
        ingots-=1;
        gridSize++;
        createGrid(gridSize);
        updateUI();
      }
    }

    function prestige(){
      if(coins>=1e7){ // 10M
        multiplier*=2;
        coins=20;
        ingots=0;
        drakeCost=20;
        gridSize=3;
        autoBuyUnlocked=false;
        autoMergeUnlocked=false;
        createGrid(gridSize);
        updateUI();
      }
    }

    function autoActions(){
      if(autoBuyUnlocked){
        while(coins>=drakeCost && getEmptyCell()){
          buyDrake();
        }
      }
      if(autoMergeUnlocked){
        for(let lvl=1;lvl<=7;lvl++){
          let sameLevel=Array.from(document.querySelectorAll(".drake"))
            .filter(d=>parseInt(d.dataset.level)===lvl);
          while(sameLevel.length>=2){
            const c1=sameLevel.pop().parentElement;
            const c2=sameLevel.pop().parentElement;
            c1.innerHTML="";
            c2.innerHTML="";
            spawnDrakeInCell(c1,lvl+1);
            sameLevel=Array.from(document.querySelectorAll(".drake"))
              .filter(d=>parseInt(d.dataset.level)===lvl);
          }
        }
      }
    }

    function updateUI(){
      coinsEl.textContent=formatNumber(coins);
      ingotsEl.textContent=formatNumber(ingots);
      incomeEl.textContent=formatNumber(calcIncome());
      multEl.textContent=formatNumber(multiplier)+"x";
      buyBtn.textContent="Buy Drake ("+formatNumber(drakeCost)+")";
    }

    function calcIncome(){
      let total=0;
      document.querySelectorAll(".drake").forEach(d=>{
        const lvl=parseInt(d.dataset.level);
        if(lvl===1) total+=1;
        else if(lvl===2) total+=3;
        else if(lvl===3) total+=10;
        else if(lvl===4) total+=25;
        else if(lvl===5) total+=50;
        else if(lvl===6) total+=100;
        else if(lvl===7) total+=250;
        else if(lvl>=8) total+=500;
      });
      return total*multiplier;
    }

    // ==== Events ====
    buyBtn.onclick=buyDrake;
    buyIngotBtn.onclick=buyIngot;
    expandBtn.onclick=expandGrid;
    prestigeBtn.onclick=prestige;

    autoBuyBtn.onclick=()=>{
      if(coins>=1e6 && !autoBuyUnlocked){
        coins-=1e6;
        autoBuyUnlocked=true;
        autoBuyBtn.textContent="Auto Buy: ON";
        updateUI();
      }
    };

    autoMergeBtn.onclick=()=>{
      if(coins>=1e6 && !autoMergeUnlocked){
        coins-=1e6;
        autoMergeUnlocked=true;
        autoMergeBtn.textContent="Auto Merge: ON";
        updateUI();
      }
    };

    saveBtn.onclick=()=>{
      const state={
        coins,ingots,multiplier,drakeCost,gridSize,
        autoBuyUnlocked,autoMergeUnlocked,
        drakes:Array.from(document.querySelectorAll(".cell")).map(c=>{
          if(c.firstChild) return parseInt(c.firstChild.dataset.level);
          return 0;
        })
      };
      localStorage.setItem("drakeSave",JSON.stringify(state));
      alert("Progress Saved!");
    };

    deleteBtn.onclick=()=>{
      localStorage.removeItem("drakeSave");
      location.reload();
    };

    function loadGame(){
      const data=localStorage.getItem("drakeSave");
      if(!data) return;
      const s=JSON.parse(data);
      coins=s.coins; ingots=s.ingots; multiplier=s.multiplier;
      drakeCost=s.drakeCost; gridSize=s.gridSize;
      autoBuyUnlocked=s.autoBuyUnlocked; autoMergeUnlocked=s.autoMergeUnlocked;
      createGrid(gridSize);
      Array.from(document.querySelectorAll(".cell")).forEach((c,i)=>{
        if(s.drakes[i]>0) spawnDrakeInCell(c,s.drakes[i]);
      });
      if(autoBuyUnlocked) autoBuyBtn.textContent="Auto Buy: ON";
      if(autoMergeUnlocked) autoMergeBtn.textContent="Auto Merge: ON";
      updateUI();
    }

    // ==== Game Loop ====
    setInterval(()=>{
      coins+=calcIncome()/1; // 1 second tick
      autoActions();
      updateUI();
    },1000);

    // ==== Init ====
    createGrid(gridSize);
    loadGame();
    updateUI();
  </script>
</body>
</html>
