<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>ðŸ”¥ Fire Drake Merge ðŸ”¥</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom, #4a0000, #990000);
      color: white;
      text-align: center;
    }
    #stats {
      font-size: 20px;
      font-weight: bold;
      padding: 10px;
      text-shadow: 0 0 5px black;
    }
    #coins { color: gold; }
    #ingots { color: #ffcc66; }
    #income { color: lime; }
    #mult { color: cyan; }
    #grid {
      display: grid;
      justify-content: center;
      gap: 5px;
      margin: 20px auto;
    }
    .cell {
      width: 90px;
      height: 90px;
      background: rgba(255,255,255,0.1);
      border: 2px solid #fff;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .drake-img { width: 60px; height: 60px; }
    .lvl-label {
      font-size: 14px;
      font-weight: bold;
      color: yellow;
    }
    #buttons {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin: 20px 0;
    }
    button {
      padding: 10px 15px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: #ff3333;
      color: white;
      font-weight: bold;
      box-shadow: 0 0 8px black;
      transition: transform 0.1s;
    }
    button:hover:enabled { transform: scale(1.05); }
    button:disabled {
      background: #444;
      color: #aaa;
      cursor: not-allowed;
      box-shadow: none;
    }
  </style>
</head>
<body>
  <div id="stats">
    Coins: <span id="coins">20</span> | 
    Ingots: <span id="ingots">0</span> | 
    Income: <span id="income">0/sec</span> | 
    Multiplier: <span id="mult">1x</span>
  </div>
  <div id="grid"></div>
  <div id="buttons">
    <button id="buyDrake">Buy Drake (20 Coins)</button>
    <button id="expandGrid">Expand Grid (1 Ingot)</button>
    <button id="autoBtn">Unlock Auto (1M Coins)</button>
    <button id="autoBuyToggle" disabled>Auto-Buy: OFF</button>
    <button id="autoMergeToggle" disabled>Auto-Merge: OFF</button>
    <button id="prestigeBtn">Prestige (10M Coins)</button>
    <button id="saveBtn">Save Progress</button>
    <button id="deleteBtn">Delete Progress</button>
  </div>

  <script>
    let coins = 20, ingots = 0, gridSize = 3, drakeCost = 20, multiplier = 1;
    let selected = null;
    let gridExpandCost = 1;
    let autoUnlocked = false;
    let autoBuyOn = false, autoMergeOn = false;

    const gameEl = document.getElementById("grid");
    const coinsEl = document.getElementById("coins");
    const ingotsEl = document.getElementById("ingots");
    const incomeEl = document.getElementById("income");
    const multEl = document.getElementById("mult");
    const buyBtn = document.getElementById("buyDrake");
    const expandBtn = document.getElementById("expandGrid");
    const autoBtn = document.getElementById("autoBtn");
    const autoBuyToggle = document.getElementById("autoBuyToggle");
    const autoMergeToggle = document.getElementById("autoMergeToggle");
    const prestigeBtn = document.getElementById("prestigeBtn");
    const saveBtn = document.getElementById("saveBtn");
    const deleteBtn = document.getElementById("deleteBtn");

    const incomes = {1:1,2:3,3:10,4:25,5:50,6:100,7:200,8:400};
    const drakeImgs = {
      1:"lvl1drake.png",
      2:"lvl2drake.png",
      3:"lvl3drake.png",
      4:"lvl4drake.png",
      5:"lvl5drake.png",
      6:"lvl6drake.png",
      7:"lvl7drake.png",
      8:"lvl8drake.png"
    };

    function formatNumber(n){
      if (n >= 1e12) return (n/1e12).toFixed(2)+"T";
      if (n >= 1e9) return (n/1e9).toFixed(2)+"B";
      if (n >= 1e6) return (n/1e6).toFixed(2)+"M";
      if (n >= 1e3) return (n/1e3).toFixed(2)+"K";
      return Math.floor(n);
    }

    function createGrid(size, oldData=[]){
      gameEl.style.gridTemplateColumns=`repeat(${size}, 90px)`;
      gameEl.innerHTML="";
      for(let i=0;i<size*size;i++){
        const cell=document.createElement("div");
        cell.className="cell";
        if(oldData[i]) placeDrake(cell,oldData[i]);
        cell.onclick=()=>selectCell(cell);
        gameEl.appendChild(cell);
      }
    }

    function placeDrake(cell,lvl=1){
      cell.innerHTML="";
      const img=document.createElement("img");
      img.src=drakeImgs[lvl];
      img.className="drake-img";
      const lbl=document.createElement("div");
      lbl.className="lvl-label";
      lbl.textContent="Lvl "+lvl;
      cell.appendChild(img);
      cell.appendChild(lbl);
      cell.dataset.lvl=lvl;
    }

    function selectCell(cell){
      if(!cell.dataset.lvl) return;
      if(!selected){selected=cell; cell.style.border="2px solid yellow";}
      else if(selected===cell){selected.style.border="2px solid #fff"; selected=null;}
      else{
        if(selected.dataset.lvl===cell.dataset.lvl){
          let newLvl=+cell.dataset.lvl+1;
          placeDrake(cell,newLvl);
          selected.innerHTML="";
          delete selected.dataset.lvl;
        }
        selected.style.border="2px solid #fff"; selected=null;
      }
    }

    function updateUI(){
      coinsEl.textContent=formatNumber(coins);
      ingotsEl.textContent=formatNumber(ingots);
      incomeEl.textContent=formatNumber(calcIncome())+"/sec";
      multEl.textContent=formatNumber(multiplier)+"x";
      buyBtn.textContent="Buy Drake ("+formatNumber(drakeCost)+" Coins)";
      expandBtn.textContent="Expand Grid ("+formatNumber(gridExpandCost)+" Ingots)";
    }

    function calcIncome(){
      let total=0;
      document.querySelectorAll(".cell").forEach(c=>{
        if(c.dataset.lvl) total+=incomes[c.dataset.lvl]||0;
      });
      return total*multiplier;
    }

    setInterval(()=>{
      coins+=calcIncome();
      if(autoUnlocked){
        if(autoBuyOn) tryBuyDrake();
        if(autoMergeOn) autoMerge();
      }
      updateUI();
    },1000);

    function tryBuyDrake(){
      if(coins>=drakeCost){
        const empty=[...document.querySelectorAll(".cell")].filter(c=>!c.dataset.lvl);
        if(!empty.length) return;
        coins-=drakeCost;
        drakeCost=Math.floor(drakeCost*1.15);
        placeDrake(empty[Math.floor(Math.random()*empty.length)],1);
      }
    }

    buyBtn.onclick=()=>{ tryBuyDrake(); updateUI(); };

    expandBtn.onclick=()=>{
      if(ingots>=gridExpandCost && gridSize<6){
        ingots-=gridExpandCost;
        gridExpandCost*=10;
        let oldData=[...document.querySelectorAll(".cell")].map(c=>c.dataset.lvl?+c.dataset.lvl:null);
        gridSize++;
        createGrid(gridSize,oldData);
        updateUI();
      }
    };

    autoBtn.onclick=()=>{
      if(coins>=1e6 && !autoUnlocked){
        coins-=1e6;
        autoUnlocked=true;
        autoBtn.textContent="Auto: Unlocked";
        autoBuyToggle.disabled=false;
        autoMergeToggle.disabled=false;
      }
    };

    autoBuyToggle.onclick=()=>{
      autoBuyOn=!autoBuyOn;
      autoBuyToggle.textContent="Auto-Buy: "+(autoBuyOn?"ON":"OFF");
    };

    autoMergeToggle.onclick=()=>{
      autoMergeOn=!autoMergeOn;
      autoMergeToggle.textContent="Auto-Merge: "+(autoMergeOn?"ON":"OFF");
    };

    prestigeBtn.onclick=()=>{
      if(coins>=1e7){
        multiplier*=2;
        coins=20; ingots=0; gridSize=3; drakeCost=20; gridExpandCost=1;
        autoUnlocked=false; autoBuyOn=false; autoMergeOn=false;
        createGrid(gridSize);
        autoBtn.textContent="Unlock Auto (1M Coins)";
        autoBuyToggle.disabled=true; autoMergeToggle.disabled=true;
        autoBuyToggle.textContent="Auto-Buy: OFF"; autoMergeToggle.textContent="Auto-Merge: OFF";
        updateUI();
      }
    };

    function autoMerge(){
      let merged=true;
      while(merged){
        merged=false;
        const cells=[...document.querySelectorAll(".cell")];
        for(let i=0;i<cells.length;i++){
          for(let j=i+1;j<cells.length;j++){
            if(cells[i].dataset.lvl && cells[i].dataset.lvl===cells[j].dataset.lvl){
              placeDrake(cells[j],+cells[j].dataset.lvl+1);
              cells[i].innerHTML=""; delete cells[i].dataset.lvl;
              merged=true; return;
            }
          }
        }
      }
    }

    saveBtn.onclick=()=>{
      const gridData=[...document.querySelectorAll(".cell")].map(c=>c.dataset.lvl?+c.dataset.lvl:null);
      const state={coins,ingots,gridSize,drakeCost,multiplier,gridExpandCost,autoUnlocked,autoBuyOn,autoMergeOn,gridData};
      localStorage.setItem("drakeSave",JSON.stringify(state));
      alert("Progress Saved!");
    };

    deleteBtn.onclick=()=>{localStorage.removeItem("drakeSave"); location.reload();};

    (function load(){
      const raw=localStorage.getItem("drakeSave");
      if(raw){
        const s=JSON.parse(raw);
        coins=s.coins; ingots=s.ingots; gridSize=s.gridSize; drakeCost=s.drakeCost; multiplier=s.multiplier;
        gridExpandCost=s.gridExpandCost||1; autoUnlocked=s.autoUnlocked; autoBuyOn=s.autoBuyOn; autoMergeOn=s.autoMergeOn;
        createGrid(gridSize,s.gridData);
        if(autoUnlocked){
          autoBtn.textContent="Auto: Unlocked";
          autoBuyToggle.disabled=false; autoMergeToggle.disabled=false;
          autoBuyToggle.textContent="Auto-Buy: "+(autoBuyOn?"ON":"OFF");
          autoMergeToggle.textContent="Auto-Merge: "+(autoMergeOn?"ON":"OFF");
        }
      } else createGrid(gridSize);
      updateUI();
    })();
  </script>
</body>
</html>
